import requests
from concurrent.futures import ThreadPoolExecutor

class VulnerabilityScanner:
    def __init__(self):
        self.payloads = {
            "SQLi": ["' OR 1=1--"],
            "XSS": ["<script>alert(1)</script>"]
        }

    def test_one(self, url, params):
        findings = []

        for param in params:
            for vuln, payloads in self.payloads.items():
                for payload in payloads:
                    data = {p: "1" for p in params}
                    data[param] = payload

                    try:
                        r = requests.get(url, params=data, timeout=5)
                        if payload in r.text or "sql" in r.text.lower():
                            evidence = r.text[:200]
                            findings.append((vuln, param, payload, evidence))
                    except:
                        pass

        return url, findings

    def test(self, targets):
        results = {}

        with ThreadPoolExecutor(max_workers=10) as executor:
            futures = []
            for url, params in targets.items():
                futures.append(executor.submit(self.test_one, url, params))

            for f in futures:
                url, findings = f.result()
                if findings:
                    results[url] = findings

        return results
